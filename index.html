<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Velvet Studio | Backend Connected</title>
    
    <!-- Favicon e Meta Tags -->
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üåπ</text></svg>">
    <meta property="og:title" content="Velvet Studio">
    <meta property="og:description" content="Agendamento online especializado.">
    
    <!-- 1. Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- 2. React Core -->
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
    <script crossorigin src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
    
    <!-- 3. Babel -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.5/babel.min.js"></script>

    <style>
        body { font-family: -apple-system, sans-serif; }
        .font-serif { font-family: 'Playfair Display', serif; }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .fade-in { animation: fadeIn 0.4s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-gray-50 text-gray-900 antialiased pb-20 select-none">
    
    <div id="root"></div>

    <!-- M√≥dulo de L√≥gica com Backend -->
    <script type="module">
        // Importando Firebase diretamente do Google (CDN Oficial)
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getFirestore, collection, addDoc, getDocs, deleteDoc, doc, query, orderBy, serverTimestamp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        // ============================================================
        // ‚ö†Ô∏è CONFIGURA√á√ÉO DO FIREBASE (J√Å INSERIDA)
        // ============================================================
        const firebaseConfig = {
            apiKey: "AIzaSyCSxmUFnFfMk7EsOX1GsVD1AeiDuePUOQ8",
            authDomain: "velvet-studio-b1242.firebaseapp.com",
            projectId: "velvet-studio-b1242",
            storageBucket: "velvet-studio-b1242.firebasestorage.app",
            messagingSenderId: "838966271868",
            appId: "1:838966271868:web:1256b0c879ffbef43a4ef9"
        };
        // ============================================================

        // Inicializa o Backend
        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);
        const DB_COLLECTION = 'agendamentos';

        // Exp√µe fun√ß√µes globais para o React usar
        window.Backend = {
            // Salvar no Banco de Dados (Cloud)
            save: async (data) => {
                try {
                    const docRef = await addDoc(collection(db, DB_COLLECTION), {
                        ...data,
                        createdAt: serverTimestamp() // Data do servidor √© mais segura
                    });
                    return { ...data, id: docRef.id };
                } catch (e) {
                    console.error("Erro ao salvar: ", e);
                    throw e;
                }
            },
            // Ler do Banco de Dados
            list: async () => {
                try {
                    const q = query(collection(db, DB_COLLECTION), orderBy("date", "asc"));
                    const querySnapshot = await getDocs(q);
                    return querySnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                } catch (e) {
                    console.error("Erro ao listar: ", e);
                    return [];
                }
            },
            // Deletar
            delete: async (id) => {
                await deleteDoc(doc(db, DB_COLLECTION, id));
            }
        };

        // Renderiza o App React (Inicia a interface)
        window.dispatchEvent(new Event('firebase-ready'));
    </script>

    <script type="text/babel">
        const { useState, useEffect } = React;
        const { createRoot } = ReactDOM;

        // --- √çCONES ---
        const Icons = {
            Menu: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><line x1="4" x2="20" y1="12" y2="12"/><line x1="4" x2="20" y1="6" y2="6"/><line x1="4" x2="20" y1="18" y2="18"/></svg>,
            X: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M18 6 6 18"/><path d="m6 6 18 18"/></svg>,
            Calendar: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="4" rx="2" ry="2"/><line x1="16" x2="16" y1="2" y2="6"/><line x1="8" x2="8" y1="2" y2="6"/><line x1="3" x2="21" y1="10" y2="10"/></svg>,
            Clock: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>,
            Flame: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M8.5 14.5A2.5 2.5 0 0 0 11 12c0-1.38-.5-2-1-3-1.072-2.143-.224-4.054 2-6 .5 2.5 2 4.9 4 6.5 2 1.6 3 3.5 3 5.5a7 7 0 1 1-14 0c0-1.153.433-2.294 1-3a2.5 2.5 0 0 0 2.5 2.5z"/></svg>,
            RollOn: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><rect width="18" height="18" x="3" y="3" rx="2" ry="2"/><line x1="3" x2="21" y1="9" y2="9"/><line x1="9" x2="9" y1="21" y2="9"/></svg>,
            Shield: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"/></svg>,
            Back: () => <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="m15 18-6-6 6-6"/></svg>
        };

        const SERVICES = [
            { id: 1, name: 'Virilha Total Velvet', price: 65, cat: 'Cera Quente', time: 30, best: true, desc: 'T√©cnica exclusiva com cera el√°stica.' },
            { id: 2, name: 'Perna Inteira Soft', price: 55, cat: 'Roll-on', time: 35, best: true, desc: 'Tecnologia Roll-on para grandes √°reas.' },
            { id: 3, name: 'Axilas (Sens√≠vel)', price: 35, cat: 'Cera Quente', time: 15, best: false, desc: 'Abertura suave dos poros. Ideal para evitar irrita√ß√µes.' },
            { id: 4, name: 'Meia Perna Express', price: 40, cat: 'Roll-on', time: 20, best: false, desc: 'Do joelho ao tornozelo.' },
            { id: 5, name: 'Face Design & Bu√ßo', price: 30, cat: 'Cera Quente', time: 15, best: false, desc: 'Cera hipoalerg√™nica facial.' },
            { id: 6, name: 'Protocolo Velvet Gold', price: 110, cat: 'Cera Quente', time: 70, best: true, desc: 'Completo: Virilha + Axilas + Bu√ßo + Hidrata√ß√£o.' }
        ];

        const Button = ({ children, onClick, variant = 'primary', className = '' }) => {
            const base = "flex items-center justify-center gap-2 px-6 py-3 rounded-xl font-bold transition-transform active:scale-95 shadow-lg ";
            const styles = { primary: "bg-gradient-to-r from-rose-500 to-rose-600 text-white shadow-rose-200", outline: "border-2 border-rose-500 text-rose-500 bg-transparent hover:bg-rose-50" };
            return <button onClick={onClick} className={base + styles[variant] + " " + className}>{children}</button>;
        };

        function App() {
            const [view, setView] = useState('home');
            const [cat, setCat] = useState('Todos');
            const [sel, setSel] = useState(null);
            const [date, setDate] = useState('');
            const [time, setTime] = useState('');
            const [apps, setApps] = useState([]);
            const [msg, setMsg] = useState(null);
            const [loading, setLoading] = useState(true);

            // Carrega dados do Firestore ao iniciar
            useEffect(() => {
                const loadData = async () => {
                    if (window.Backend) {
                        const data = await window.Backend.list();
                        setApps(data);
                        setLoading(false);
                    } else {
                        // Espera o Firebase carregar
                        window.addEventListener('firebase-ready', async () => {
                            const data = await window.Backend.list();
                            setApps(data);
                            setLoading(false);
                        });
                    }
                };
                loadData();
            }, []);

            const notify = (txt) => { setMsg(txt); setTimeout(() => setMsg(null), 3000); };
            const fmtMoney = (v) => new Intl.NumberFormat('pt-BR', { style: 'currency', currency: 'BRL' }).format(v);
            const filtered = cat === 'Todos' ? SERVICES : SERVICES.filter(s => s.cat === cat);

            const confirmBooking = async () => {
                if(!date || !time) return notify("Escolha data e hor√°rio!");
                setLoading(true);
                try {
                    // Salva no Firestore
                    await window.Backend.save({ service: sel.name, price: sel.price, cat: sel.cat, date, time });
                    // Recarrega lista
                    const newData = await window.Backend.list();
                    setApps(newData);
                    notify("Agendamento Confirmado!");
                    setView('dash');
                } catch(e) {
                    notify("Erro ao conectar.");
                } finally {
                    setLoading(false);
                }
            };

            const cancelBooking = async (id) => {
                if(confirm("Cancelar este agendamento?")) {
                    setLoading(true);
                    await window.Backend.delete(id);
                    const newData = await window.Backend.list();
                    setApps(newData);
                    setLoading(false);
                    notify("Cancelado com sucesso.");
                }
            };

            // Loading Screen
            if(loading && apps.length === 0 && view !== 'home') {
                 return <div className="min-h-screen flex items-center justify-center"><div className="w-10 h-10 border-4 border-rose-500 rounded-full border-t-transparent animate-spin"></div></div>;
            }

            if (view === 'home') return (
                <div className="fade-in">
                    <div className="relative h-[480px] bg-gray-900 overflow-hidden">
                        <img src="https://images.unsplash.com/photo-1515377905703-c4788e51af15?q=80&w=800&auto=format&fit=crop" className="absolute w-full h-full object-cover opacity-60" />
                        <div className="absolute inset-0 bg-gradient-to-t from-gray-900 via-transparent to-transparent"></div>
                        <div className="absolute inset-0 flex flex-col justify-center px-6 z-10">
                            <div className="inline-flex items-center gap-2 px-3 py-1 border border-white/30 rounded-full text-white/90 text-[10px] uppercase tracking-widest mb-4 w-fit bg-black/20 backdrop-blur"><Icons.Shield /> Protocolos Certificados</div>
                            <h1 className="text-5xl text-white font-light leading-tight mb-4">A Arte da <br/><span className="font-bold text-rose-300">Suavidade.</span></h1>
                            <Button onClick={() => document.getElementById('menu').scrollIntoView({behavior:'smooth'})}>Agendar Sess√£o</Button>
                        </div>
                    </div>

                    <div id="menu" className="px-4 py-10 max-w-3xl mx-auto">
                        <div className="flex items-end justify-between mb-6">
                            <div><span className="text-rose-500 font-bold text-xs uppercase tracking-wider">Nosso Menu</span><h2 className="text-2xl font-bold text-gray-800">Protocolos</h2></div>
                            <div className="flex gap-2">
                                {['Todos', 'Cera Quente', 'Roll-on'].map(c => (<button key={c} onClick={() => setCat(c)} className={`px-3 py-1 rounded-lg text-xs font-bold transition ${cat === c ? 'bg-rose-500 text-white' : 'bg-gray-200 text-gray-600'}`}>{c}</button>))}
                            </div>
                        </div>
                        <div className="grid gap-6 md:grid-cols-2">
                            {filtered.map(s => (
                                <div key={s.id} className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 relative group hover:shadow-lg transition">
                                    {s.best && <div className="absolute top-0 right-0 bg-rose-500 text-white text-[10px] font-bold px-3 py-1 rounded-bl-xl">TOP</div>}
                                    <div className="flex justify-between items-start mb-3">
                                        <span className={`px-2 py-1 rounded-md text-[10px] font-bold uppercase flex items-center gap-1 ${s.cat === 'Cera Quente' ? 'bg-orange-100 text-orange-700' : 'bg-teal-100 text-teal-700'}`}>{s.cat === 'Cera Quente' ? <Icons.Flame /> : <Icons.RollOn />} {s.cat}</span>
                                        <span className="text-xs text-gray-400 flex items-center gap-1"><Icons.Clock /> {s.time} min</span>
                                    </div>
                                    <h3 className="text-lg font-bold text-gray-900 mb-1">{s.name}</h3>
                                    <p className="text-sm text-gray-500 mb-4">{s.desc}</p>
                                    <div className="flex items-center justify-between mt-4 border-t border-gray-50 pt-3">
                                        <span className="text-xl font-bold text-gray-900">{fmtMoney(s.price)}</span>
                                        <Button variant="outline" className="px-4 py-2 text-xs" onClick={() => { setSel(s); setView('book'); window.scrollTo(0,0); }}>Agendar</Button>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </div>
                    <div className="fixed bottom-6 right-6 z-40">
                         <button onClick={() => setView('dash')} className="bg-gray-900 text-white p-4 rounded-full shadow-2xl flex items-center gap-2 font-bold text-sm"><Icons.Calendar /> Minha Agenda</button>
                    </div>
                </div>
            );

            if (view === 'book') return (
                <div className="min-h-screen bg-gray-50 p-4 fade-in">
                    <div className="max-w-md mx-auto">
                        <button onClick={() => setView('home')} className="mb-6 flex items-center text-gray-500 text-xs font-bold uppercase gap-1"><Icons.Back /> Voltar ao Studio</button>
                        <div className="bg-white rounded-3xl shadow-xl overflow-hidden">
                            <div className="bg-gray-900 p-8 text-white relative">
                                <div className="absolute top-0 right-0 w-32 h-32 bg-rose-500 rounded-full blur-[60px] opacity-40"></div>
                                <h2 className="text-xl font-light relative z-10">Finalizar <span className="font-bold">Sess√£o</span></h2>
                                <p className="text-white/60 text-sm mt-1">{sel.name}</p>
                            </div>
                            <div className="p-6 space-y-6">
                                <div className="bg-rose-50 p-4 rounded-xl border border-rose-100 flex justify-between items-center">
                                    <div><div className="text-[10px] font-bold text-rose-400 uppercase">Valor</div><div className="text-2xl font-bold text-rose-600">{fmtMoney(sel.price)}</div></div>
                                    <div className="text-right"><div className="text-[10px] font-bold text-rose-400 uppercase">Dura√ß√£o</div><div className="text-sm font-bold text-rose-600">{sel.time} min</div></div>
                                </div>
                                <div><label className="text-xs font-bold text-gray-500 uppercase block mb-2">Data</label><input type="date" className="w-full bg-gray-100 rounded-xl p-3 font-bold text-gray-700 outline-none focus:ring-2 focus:ring-rose-500" value={date} onChange={e => setDate(e.target.value)} /></div>
                                <div><label className="text-xs font-bold text-gray-500 uppercase block mb-2">Hor√°rio</label><input type="time" className="w-full bg-gray-100 rounded-xl p-3 font-bold text-gray-700 outline-none focus:ring-2 focus:ring-rose-500" value={time} onChange={e => setTime(e.target.value)} /></div>
                                <Button className="w-full py-4 mt-4" onClick={confirmBooking}>{loading ? 'Confirmando...' : 'Confirmar'}</Button>
                            </div>
                        </div>
                    </div>
                </div>
            );

            if (view === 'dash') return (
                <div className="min-h-screen bg-gray-50 p-4 fade-in">
                    <div className="max-w-md mx-auto">
                        <div className="flex justify-between items-center mb-8"><h2 className="text-2xl font-bold text-gray-900">Sua Agenda</h2><Button variant="outline" onClick={() => setView('home')}>Voltar</Button></div>
                        {apps.length === 0 ? (
                            <div className="text-center py-16 border-2 border-dashed border-gray-200 rounded-3xl bg-white">
                                <div className="mx-auto text-gray-300 mb-2 flex justify-center"><Icons.Calendar /></div>
                                <div className="font-bold text-gray-400">Nenhum agendamento</div>
                                <button onClick={() => setView('home')} className="text-rose-500 font-bold text-sm mt-2">Agendar agora</button>
                            </div>
                        ) : (
                            <div className="space-y-4">
                                {apps.map(app => (
                                    <div key={app.id} className="bg-white p-5 rounded-2xl shadow-sm border border-gray-100 flex items-center justify-between">
                                        <div className="flex items-center gap-4">
                                            <div className={`p-3 rounded-xl text-white ${app.cat === 'Cera Quente' ? 'bg-orange-500' : 'bg-teal-500'}`}>{app.cat === 'Cera Quente' ? <Icons.Flame /> : <Icons.RollOn />}</div>
                                            <div><div className="font-bold text-gray-900">{app.service}</div><div className="text-xs text-gray-500 flex gap-2 mt-1"><span>{new Date(app.date).toLocaleDateString('pt-BR')}</span><span>‚Ä¢ {app.time}</span></div></div>
                                        </div>
                                        <button onClick={() => cancelBooking(app.id)} className="text-red-400 hover:text-red-600"><Icons.X /></button>
                                    </div>
                                ))}
                            </div>
                        )}
                    </div>
                </div>
            );

            if (msg) return <div className="fixed bottom-6 left-1/2 -translate-x-1/2 z-50 bg-gray-900 text-white px-6 py-3 rounded-full shadow-2xl font-bold text-sm flex items-center gap-2 animate-bounce"><Icons.Shield /> {msg}</div>;
        }

        const root = createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
